<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>v-admin</title>
    <script src="https://unpkg.com/jquery@1.12.4/dist/jquery.js" ></script>
    <script src="https://unpkg.com/vue@2" ></script>
    <script src="https://unpkg.com/iview@2/dist/iview.min.js"></script>
    <script src="./v-admin.js" ></script>
    <link rel="stylesheet" href="https://unpkg.com/iview@2/dist/styles/iview.css" />
    <link rel="stylesheet" href="./v-admin.css">
</head>
<body>
    <div id="app" style="padding:20px;" >
        <h2>ajax form</h2>
        <code>&lt;v-form&gt;&lt;/v-form&gt;</code>
        <br />
        使用方法参考 <a href="./ajax.html">./ajax.html</a> <br />
        只是将 url 换成 action, type 换成 method。
        <v-form action="/mock/ok.json" method="get" style="width:200px;"  >
            <div class="ivu-form-item">
                <i-input name="user"  value="username" ></i-input>
            </div>
            <div class="ivu-form-item">
                <i-select name="some" value="b"  >
                    <i-option value="a" >张三</i-option>
                    <i-option value="b" >李四</i-option>
                </i-select>
            </div>
            <i-button html-type="submit" type="primary" long >提交</i-button>
        </v-form>
    </div>
<script>
Vue.component('v-form', {
    props: ['action', 'method'],
    template: '<form v-on:submit.prevent="onSubmit" ><slot></slot></form>',
    data: function () {
        return {
            busy: false
        }
    },
    methods: {
        onSubmit: function (e) {
            var self = this
            if (self.busy) {
                return
            }
            var url = self.action
            var type = self.method
            self.busy = true
            var ajaxOptions = {
                type: type,
                url: url,
                data: $(e.target).serializeArray()
            }
            var lifeCycle = {
                willFetch: function () {
                    self.busy = true
                },
                didFetch: function () {
                    self.busy = false
                },
                success: function (defaultAction) {
                    self.$emit('success', [defaultAction])
                }
            }
            var callAjax = function () {
                vAdmin.ajax(ajaxOptions, self.$listeners, lifeCycle)
            }
            callAjax()
        }
    }
})
new Vue({
    el: '#app',
    data: function () {
        return {

        }
    }
})
</script>
</body>
</html>
